{% if backends %}
<div class="space-y-2">
    {% for name, backend in backends.items() %}
    <div
        class="flex items-center justify-between p-2 rounded {% if backend.status.connected %}bg-green-50{% else %}bg-red-50{% endif %}">
        <div class="flex items-center gap-2">
            <span
                class="w-2.5 h-2.5 rounded-full {% if backend.status.connected %}bg-green-500{% else %}bg-red-500{% endif %}"></span>
            <span class="font-medium text-gray-800">{{ name }}</span>
            <span class="text-xs text-gray-500">({{ backend.backend_type }})</span>
        </div>
        <div class="text-right flex items-center gap-2">
            {% if backend.status.connected %}
            {% if backend.status.cpus_user is not none and backend.status.cpus_idle is not none %}
            <span class="text-xs text-gray-600">Using <span class="font-medium text-blue-600">{{ backend.status.cpus_user }}</span> CPUs in {{ backend_job_counts.get(name, 0) }} jobs, <span class="font-medium">{{ backend.status.cpus_idle }}</span> available</span>
            {% else %}
            <span class="text-xs text-gray-500">{{ backend_job_counts.get(name, 0) }} jobs</span>
            {% endif %}
            {% if backend.status.last_poll_duration_ms is not none %}
            <span
                class="text-xs font-mono {% if backend.status.last_poll_duration_ms > 5000 %}text-red-500{% elif backend.status.last_poll_duration_ms > 2000 %}text-yellow-600{% else %}text-gray-400{% endif %}"
                title="Poll duration">{{ backend.status.last_poll_duration_ms }}ms</span>
            {% endif %}
            {% if backend.status.last_poll %}
            <span class="text-xs text-gray-400">{{ backend.status.last_poll.strftime('%H:%M:%S')
                }}</span>
            {% endif %}
            {% else %}
            <span class="text-sm text-red-700">Disconnected</span>
            {% if backend.status.last_poll_duration_ms is not none %}
            <span class="text-xs font-mono text-gray-400">{{ backend.status.last_poll_duration_ms
                }}ms</span>
            {% endif %}
            {% endif %}
        </div>
    </div>
    {% if backend.status.error %}
    <div class="ml-4 p-2 bg-red-100 rounded text-sm text-red-700 font-mono text-xs">
        {{ backend.status.error }}
    </div>
    {% endif %}
    {% endfor %}
</div>
{% else %}
<p class="text-sm text-gray-500">No backends configured</p>
{% endif %}
